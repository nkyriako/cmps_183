{{extend 'layout.html'}}

<script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
<script src="https://npmcdn.com/bootstrap@4.0.0-alpha.5/dist/js/bootstrap.min.js"></script>

<script>var counter = 5;</script> <!--Global variable for page that keeps track of number of snippets being shown-->

<div id = 'test'>
    {{for name in db(db.story.title == openstory.title).select():}} <!--Selects all snippets in database with title, 'HELLO!' (temporary).-->
        {{if name.ishead == True:}}
            <div id = 'num_snip'>Snippets: {{=name.num_snippets}}</div> <!--Prints number of snippets (replies only, not the 'head' snippet)-->
        {{pass}}
    {{pass}}
	{{if openstory is None:}}
		<h1>openstory is none</h1>
    {{else:}}
    	<h1>{{=openstory.title}}</h1>
    	{{for name in db(db.story.title == openstory.title).select(limitby = (0, 5)):}} <!--Selects all snippets in database with title-->
        	<div id = 'snippet'>
                <div id = 'user_name'>{{=name.user_email}}</div> 
                <div id = 'text'>{{=name.snippets}}</div> <!-- Finds all snippets with the title above-->
            </div>
    	{{pass}}
    {{pass}}
</div>
<div id = "show_more">
    <!--Button for showing more snippets, javascript.void(0) brings user to same page-->
    {{if len(entries) > 5:}}
        <a class = "button" id = "more_comments" href = "javascript:void(0)" onclick="show_more()">Show more snippets...</a>
    {{pass}}
    <script>
        function show_more() { // shows more snippets
            var snip_arr = {{=XML(entries)}} // sets python array to js array/variable'
            var user_arr = {{=XML(usernames)}}
            // prints rest of snippets
            for (var i = counter; i < counter + 5; i += 1) {
                if (i == snip_arr.length)
                {
                    break;
                }
                var new_snippet = document.createElement('div'); // creates new snippet div
                var new_text = document.createElement('div'); // creates new text div
                var new_user = document.createElement('div'); // creates new username div
                new_snippet.id = 'temp_snip'; // sets id to temporary name, since we don't want the next lines to effect other divs that are "snippet"s
                new_text.id = 'temp_text';
                new_user.id = 'temp_user';
                document.getElementById('test').appendChild(new_snippet); // adds new_div to page
                new_snippet.appendChild(new_user); // adds username div to snippet box
                new_snippet.appendChild(new_text); // same as above, but adds the text
                new_user.innerHTML = user_arr[i]; // sets new_div contents to snippets from array
                new_text.innerHTML = snip_arr[i];
                new_snippet.id = 'snippet'; // sets id name to snippet
                new_user.id = 'user_name';
                new_text.id = 'text';
            }
            counter += 5; // increments counter
        }
    </script>
    <script> 
        var button = document.getElementById('more_comments');
        button.addEventListener('click', hide_show, false);// when button is clicked, calls hideshow function
        var snip_num = {{=XML(entries)}}.length // sets var to number of snippets in topic
        function hide_show() {
            if (counter >= snip_num)
            {
                this.style.display = 'none' // hides button
            }
        }
    </script>
</div>
<div id = "text_box">
    {{if finish == True:}}
        <h2>The story has finished</h2>
    {{else:}}
        <h2>Your snippet</h2>
        {{=snippet}}
    {{pass}}
</div>

<a href="{{=URL('default', 'index')}}" class="btn large">Back</a>
