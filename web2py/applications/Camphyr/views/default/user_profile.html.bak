{{extend 'layout.html'}}

{{block header}}

{{end}}

{{ if cl is None: }}

    {{ redirect(URL('default', 'edit_profile')) }}

{{ else: }}
    <div class="logo">
        <div id="logo">Camphyr</div>
    </div>
    <h1 class="center lifted" style="color:white;background-color:orange;opacity:.7;"> {{=username}}'s Profile </h1>
    <div class="left_column" style="margin:5px;float:left;">
        {{if cl is not None:}}
            {{=IMG(_src=URL('static', 'images/prof_pics', args=file_name),
                    _height='200px', _width='200px', _style='border:6px solid #45754a')}}
            {{else:}}
                {{=IMG(_src=URL('static', 'images/prof_pics/default_profile.jpg'),
                       _height='200px', _width='200px', _style='border:6px solid #45754a')}}
            {{pass}}
        <p>
            {{=bio}}
        </p>
        {{if str(cl.user_email) == str(auth.user.email):}}
                <a href="{{=URL('default', 'edit_profile')}}" class="btn">Edit Profile</a>
        {{pass}}
    </div>
    <div class="right_column" style="float:right;">
        <div id = "contributed">
            <h3 style="color:white;background-color:rgb(255,98,104);opacity:.8;" class = "lifted">Recent stories {{=username}} has added to:</h3>
            {{id_list = db(db.user_profile.user_email == cl.user_email).select().first().contribution_id}}
            {{updated_list = []}}
            {{for unique_id in id_list:}}
                {{if unique_id not in updated_list:}}
                    {{updated_list.append(unique_id)}}
                {{pass}}
            {{pass}}
            {{for id in updated_list:}}
                <div id = 'contribute'>
                    {{link = db(db.story.storyId == id).select().first()}}
                    <a style="color:orange" href = '{{=link.address}}'>{{=link.title}}</a>
                </div>
            {{pass}}
        </div>
        <div id = "standalone">
            <h3 style="color:white;background-color:rgb(255,98,104);opacity:.8;" class = "lifted">Personal stories by {{=username}}:</h3>
            {{for name in db(db.bio_story.user_email == cl.user_email).select():}} <!--Selects all snippets in database with title-->
                <div id = 'story'>
                    {{link = URL('default', 'user_story', vars = dict(title_name = name.title))}} <!--creates a link to the story-->
                    <a style="color:orange;" href = '{{=link}}'>{{=name.title}}</a>
                </div>
            {{pass}}
            {{if str(cl.user_email) == str(auth.user.email):}}
                <a href="{{=URL('default', 'create_story')}}" class="btn">Create new story...</a>
            {{pass}}
        </div>
    </div>
    <div>
        <a href="{{=URL('default', 'index')}}" class="btn ">Return to Camphyr</a>
    </div>
    {{pass}}
{{pass}}
